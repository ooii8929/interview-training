<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>Document</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!-- include libraries(jQuery, bootstrap) -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!-- include summernote css/js -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
    <style>
        .navbar-brand {
            width: 100px;
        }

        #ans {
            text-align: center;
        }

        .article {
            display: inline-block;
            border: 1px solid black;
            text-align: center;
            margin: auto;
            margin-top: 2%;
            width: 70%;
        }

        .good {
            background-color: #fff;
        }

        .good-clicked {
            background-color: blue;
        }
    </style>
</head>

<body>
    <div id="main-menu"></div>
    <div id="ans"></div>
    <div>
        <textarea id="summernote" name="editordata"></textarea>
        <button onclick="postComment()">提交</button>
    </div>


    <script>
        let userId = sessionStorage.getItem('userid');
        let articleID;
        $(document).ready(function () {
            $('#summernote').summernote();
        });

        async function postComment() {
            let summerNote = document.getElementById('summernote').value;
            console.log('summerNote', summerNote);
            let postCommentDetail = {
                user_id: userId,
                article_id: articleID,
                summerNote: summerNote
            }
            let postCommentResult = await axios.post('/api/1.0/article/comment', postCommentDetail)
            console.log('postCommentResult', postCommentResult);
        }

        async function postGood(e) {
            let summerNote = document.getElementById('summernote').value;
            let postDetail = {
                user_id: userId,
                article_id: articleID,
            }
            if (e.classList.contains("good")) {
                e.classList.remove("good");
                e.classList.add("good-clicked");
                let postGoodDetail = {
                    user_id: userId,
                    article_id: articleID,
                }
                let res = await axios.post("/api/1.0/article/good", postDetail);
                console.log('post good', res);
            } else {
                e.classList.remove("good-clicked");
                e.classList.add("good");
                let res = await axios.post("/api/1.0/article/bad", postDetail);
                console.log('post bad', res);
            }
        }

        async function getArticles() {
            let urlParams = new URLSearchParams(window.location.search);
            let tmpPar = urlParams.get('article-id'); // true

            let res = await axios.get("/api/1.0/article/id", {
                params: {
                    article_id: tmpPar
                }
            });
            console.log('res', res['data'][0]);
            articleID = res['data'][0]['_id'];

            document.querySelector("#ans").innerHTML += `
                <div>${res['data'][0].title}</div>
                <div>${res['data'][0].description}</div>
                <div>${res['data'][0].language}</div>
                <code>${res['data'][0].code}</code>
                `;

            if (res['data'][0].goods.includes(userId)) {
                document.querySelector("#ans").innerHTML += `<button class="good-clicked" onclick="postGood(this)">點讚</button>`;
            } else {
                document.querySelector("#ans").innerHTML += `<button class="good" onclick="postGood(this)">點讚</button>`;
            }
            res['data'][0]['comments'].forEach(e => {
                document.querySelector("#ans").innerHTML += `
                <div class="article">
                <div>${e['content']}</div>
                <div>${e['create_dt']}</div>
                </div>`;
            });
        }
        getArticles()
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

    <script>$('#main-menu').load('/header/index.html');
        function goTrain() {
            sessionStorage.setItem('profession', $('#select-profession').val());
            window.location.href = '/training/sense.html';

        }
    </script>
</body>

</html>